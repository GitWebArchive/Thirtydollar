let sounds={},soundcloud=new AudioContext,recent=new Set;const mobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent);mobile&&$("p[mobile]").each((function(){$(this).text($(this).attr("mobile")),$(".nomobile").hide()}));const intros=[{name:$("#caption").text(),path:"assets/dont_you_lecture_me.wav"},{name:"how you gonna talk behind my back when you deadass built like a",path:"assets/you_deadass_built_like_a.wav"},{name:"white people be like",path:"assets/white_people_be_like.wav"}],actions=[{shortcut:"t",action:"Set tempo",amount:!0,name:"speed",image:"assets/action_speed.png",default:300,set:[10,1e4],add:[-1e4,1e4],multiply:[.01,1e3,.1]},{shortcut:"v",action:"Set volume",amount:!0,name:"volume",image:"assets/action_volume.png",default:100,set:[0,600,1,"%"],add:[-600,600,1,"%"],multiply:[.01,1e3,.1]},{shortcut:"p",action:"Pause for duration",amount:!0,name:"stop",image:"assets/action_stop.png",default:4,set:[0,1e3]},{shortcut:"m",action:"Transpose",amount:!0,name:"transpose",image:"assets/action_transpose.png",default:1,set:[-60,60],add:[-60,60],multiply:[.01,100,.1]},{shortcut:"l",action:"Loop",amount:!0,name:"loopmany",image:"assets/action_loopmany.png",default:4,set:[1,1e3]},{shortcut:"r",action:"Loop once",name:"loop",image:"assets/action_loop.png"},{shortcut:"s",action:"Set loop start point",name:"looptarget",image:"assets/action_looptarget.png"},{shortcut:"c",action:"Combine sounds",name:"combine",image:"assets/action_combine.png"},{shortcut:"g",action:"Go to target",isTarget:!0,name:"jump",image:"assets/action_jump.png",set:[1,9999]},{shortcut:"a",action:"Target",isTarget:!0,name:"target",image:"assets/action_target.png",set:[1,9999]},{shortcut:"x",action:"Stop all sounds",name:"cut",stopSounds:!0,image:"assets/action_cut.png"},{shortcut:"o",action:"Set start position",name:"startpos",image:"assets/action_startpos.png"},{shortcut:"d",action:"Add divider",name:"divider",image:"assets/action_divider.png"},{shortcut:"f",action:"Flash screen",name:"flash",image:"assets/action_flash.png"},{shortcut:"u",action:"Pulse screen",amount:!0,twoValues:[[0,1e3],[.1,128]],scroll:[0,1],default:[1,2],name:"pulse",image:"assets/action_pulse.png"},{shortcut:"b",action:"Set background color",amount:!0,colorMode:!0,twoValues:[["color"],[0,128]],scroll:[1,.25],default:["X",1],name:"bg",image:"assets/action_bg.png"}];actions.forEach((e=>{$("#actions").append(`<div class="action" action="${e.name}" info="${e.action}" key="${e.shortcut.toUpperCase()}"><img action="${e.name}" alt="${e.action}" src="${e.image}">${e.amount?"<p>+</p>":""}</div>`)}));let soundList=[];fetch("./sounds.json").then((e=>e.json())).then((e=>{soundList=e,$("#iconboxLoading").hide(),$("#icons").removeClass("loadingIcons"),e.forEach((e=>{let t=!e.emoji&&e.id.match(/[a-z0-9]/i)?`icons/${e.img||e.id}.png`:`https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/${(e.emoji||e.id).codePointAt(0).toString(16)}.svg`;$("#icons").append(`<div class="sound" soundName="${e.name}" soundOrigin="${e.source||""}" sound="sounds/${e.id}.wav" str="${e.id}" ${(e.tags||[]).map((e=>"tag_"+e)).join(" ")}><img alt="${e.name}" src="${t}"></div>`),lastGroup=e.group,settings.proMode&&($(".hotbarTab").first().trigger("click"),$("#proHotbar").show(),$("#extraPadding").show(),buildHotbar())}))})).catch((e=>{console.error(e),$("#icons img").hide(),$("#icons").addClass("loadingIcons"),$("#iconboxLoading").show(),$("#loadingText").text("Something went wrong!"),$("#errorInfo").text(e.message)}));let hotbar=$("#hotbarNotes");function buildHotbar(e="sounds"){if($("#hotbarNotes .placed").removeClass("placed"),hotbar.html(""),"recent"==e){return void[...recent].slice(-48).reverse().forEach((e=>{e.startsWith(".")?hotbar.append($(`#actions div[action=${e.slice(1)}]`).prop("outerHTML")||""):hotbar.append($(`#icons div[str=${e}]`).prop("outerHTML")||"")}))}let t="actions"==e?"#actions div":["recent","favorite"].includes(e)?"#icons div, #actions div":"#icons div";$(t).each((function(){let t=$(this);("notes"!=e||t.is("[tag_note]"))&&("percussion"!=e||t.is("[tag_percussion]"))&&hotbar.append(t.prop("outerHTML"))}))}function updateRecent(e){recent.delete(e),recent.add(e)}let defaultBG="#36393c",colorRegex=/^#[a-f0-9]{6}$/i,cloneSort=!1;function getPrefix(e,t){return"plus"==e?t>=0?"+":"":"add"==e?"+":"multiply"==e?"⨯":""}function addToSequence(e,t,o){let n=e.attr("addToStart");n&&e.removeAttr("addToStart");let i=shiftHeld&&!t||n,s=$(`#sequence section[group="${selectedDivider}"]`);if(o>=0&&selectedDivider!=o&&(s=[]),s.length||(s=i?$("#sequence section").first():$("#sequence section").last()),!s.length)return $("#sequence").append('<section group="0"></section>'),addToSequence(e);i?s.prepend(e):appendToSection(s,e),"divider"==e.attr("action")&&syncSections()}function appendToSection(e,t){let o=e.children().last();"divider"==o.attr("action")?t.insertBefore(o):e.append(t)}function addAction(e,t,o="set",n=stash,i=!1){if("string"==typeof t&&t.startsWith("#")&&(t=$(t).val()),!n||isNaN(t))return;let s=Number(Number(t).toFixed(3)),a=actions.find((t=>t.name==e))[o];s=clamp(s,a[0],a[1]);let c=getPrefix(o,s)+String(s)+(a[3]||"");if("set"!=o&&n.attr("num",o),isNaN(a[2])||n.attr("step",a[2]),a[3]&&n.attr("suffix",a[3]),settings.noAnimations||n.addClass("placed"),n.attr("amount",s).find("p").text(c),replaceAction)editAction(n);else{if(i)return n;addToSequence(n)}updateRecent("."+e),stash&&(stash=null),$(".popup").hide()}function addAdvancedAction(e,t,o=stash,n=!1){let i=actions.find((t=>t.name==e));if(!i||!Array.isArray(t))return;let s=t.map(((e,t)=>{let o=i.twoValues[t];return"color"==o?e=e.match(colorRegex)?e:defaultBG:Array.isArray(o)&&(e=clamp(e,o[0],o[1])),e}));if(o.attr("advanced",!0).attr("val1",s[0]).attr("val2",s[1]),i.colorMode?o.find("p").html(`<span style="color: ${s[0]}; margin-right: 2.5px">⬤</span> <span>${s[1]}<span>`):o.find("p").text(`${s[0]}, ${s[1]}`),replaceAction)editAction(o);else{if(n)return o;addToSequence(o)}stash&&(stash=null),$(".popup").hide()}function editAction(e){replaceAction.replaceWith(e),replaceAction.runAnimation("placed"),replaceAction=null}function syncSections(){let e=[""],t=0,o=[];$(".placed").removeClass("placed"),$(".selectedDivider").removeClass("selectedDivider"),$("#sequence div").each((function(){let n="divider"==$(this).attr("action");if(n){Number($(this).attr("section"))>=0&&$(this).parent().hasClass("sectionHidden")&&o.push(t),$(this).attr("section",t)}e[t]+=$(this).prop("outerHTML"),n&&(t++,e.push(""))})),$("#sequence").html(e.map(((e,t)=>`<section class="${t==selectedDivider?"selectedDivider":""} ${o.includes(t)?"sectionHidden":""}" group="${t}">${e}</section>`)).join("")),t>0?$("#sectionSettings").show():$("#sectionSettings").hide()}function hasDividers(){return $("#sequence section").length>1}function deselectSection(){selectedDivider=-1,ctrlHeld&&$(".selectedDivider").addClass("removedDivider"),displaySection()}function changeSection(e,t){let o=$("#sequence section").length;if(o<=1)return selectedDivider=-1;-1==selectedDivider&&e<0?selectedDivider=o-1:-1==selectedDivider&&e>0?selectedDivider=0:selectedDivider+=e,selectedDivider<0?selectedDivider=o-1:selectedDivider>=o&&(selectedDivider=0),displaySection(t)}function displaySection(e){if($(".selectedDivider").removeClass("selectedDivider"),selectedDivider>=0){let t=$(`#sequence section[group="${selectedDivider}"]`);t.addClass("selectedDivider"),$(".requiresSelected").removeClass("cantSelect"),$("#selectedSection").text(selectedDivider+1),t.hasClass("sectionHidden")?($("#hideSection").hide(),$("#showSection").show()):($("#hideSection").show(),$("#showSection").hide()),!active&&e&&$("#everything").stop().animate({scrollTop:t.prop("offsetTop")-150},100)}else $(".requiresSelected").addClass("cantSelect"),$("#selectedSection").text("None"),$("#hideSection").show(),$("#showSection").hide()}function toggleSectionVisibility(e=selectedDivider){e<0||($(`#sequence section[group="${e}"]`).toggleClass("sectionHidden"),displaySection())}function whatthefuck(e,t){$("#sequence").sortable("cancel"),e.remove().insertAfter("#sequence div")[t]}$("#sequence").sortable({tolerance:"pointer",helper:"clone",containment:"#sequence",placeholder:"sortPlaceholder",items:"div",cursor:"move",delay:mobile?1500:0,forcePlaceholderSize:!0,forceHelperSize:!0,start:function(e,t){cloneSort=shiftHeld||altHeld,cloneSort&&t.item.addClass("shiftPlaceholder"),t.placeholder.html(t.item.html())},stop:function(e,t){cloneSort&&(t.item.clone().insertAfter(t.item),$(this).sortable("cancel"),t.item.clone()),cloneSort=!1,$(".shiftPlaceholder").removeClass("shiftPlaceholder"),$(".placed").removeClass("placed"),cancel(),$("#sequence section").length>1&&("divider"==t.item.attr("action")&&deselectSection(),syncSections())}}),$(document).on("mouseover","#icons div",(function(){let e=$(this).attr("soundName"),t=$(this).attr("soundOrigin");$("#soundText").hide(),$("#soundName").text(e),$("#soundOrigin").text(t?` (${t})`:""),$("#soundInfo").show()})),$(document).on("mouseleave","#icons div",(function(){$("#soundInfo").hide(),$("#soundText").show()})),$(document).on("mouseover","#actions div",(function(){$("#actionText").hide(),$("#actionInfo").show(),$("#actionName").text($(this).attr("info")),mobile||settings.noActionShortcuts?$("#actionKey").hide():$("#actionKey").text("("+$(this).attr("key")+")").show()})),$(document).on("mouseleave","#actions div",(function(){$("#actionInfo").hide(),$("#actionText").show()})),$(document).on("mouseover","#sequence div",(function(){(shiftHeld||altHeld)&&$(this).addClass("holdingShift")})),$(document).on("mouseleave","#sequence div",(function(){$(".holdingShift").removeClass("holdingShift")})),$(document).on("mouseover","#sequence section",(function(){ctrlHeld&&hasDividers()&&$(this).addClass("holdingCtrl")})),$(document).on("mouseleave","#sequence section",(function(){$(".holdingCtrl").removeClass("holdingCtrl")})),$(document).on("mouseleave","#sequence .removedDivider",(function(e){e.isTrigger||$(this).removeClass("removedDivider")})),$(document).on("mouseover",".hotbarTab",(function(){$("#hotbarText").css("color","var(--yellowfont)").text($(this).attr("desc")).show(),$("#hotbarContext").css("color","var(--yellowfont)").text("("+($(this).index()+1)+")").show()})),$(document).on("mouseover","#hotbarNotes div.sound",(function(){let e=$(this).attr("soundOrigin");$("#hotbarText").css("color","var(--greenfont)").text($(this).attr("soundName")).show(),mobile||$("#hotbarContext").css("color","var(--greenfont)").text(e?`(${e})`:"").show()})),$(document).on("mouseover","#hotbarNotes div.action",(function(){$("#hotbarText").css("color","var(--bluefont)").text($(this).attr("info")).show(),mobile||settings.noActionShortcuts||$("#hotbarContext").css("color","var(--bluefont)").text("("+$(this).attr("key")+")").show()})),$(document).on("mouseleave","#hotbarNotes div, .hotbarTab",(function(e){$("#hotbarText, #hotbarContext").text("").hide()})),$(document).on("click contextmenu",".iconbox, #proHotbar",(function(){return!1})),$(document).on("click contextmenu","#icons div, #hotbarNotes div.sound",(function(e){cancel();let t=$(this).attr("sound"),o=$(this).attr("str"),n=$(this.outerHTML),i=null;if("contextmenu"==e.type)return settings.noAnimations||$(this).runAnimation("placed"),playSound(t),!1;t.startsWith("_")||(settings.noAnimations||n.runAnimation("placed"),playSound(t,{pitch:semitonesToPercent(i)})),n.removeAttr("soundorigin"),n.removeAttr("soundname"),updateRecent(o),addToSequence(n)})),$(document).on("click contextmenu","#actions div, #hotbarNotes div.action",(function(e){cancel();let t=$(this).attr("action"),o=actions.find((e=>e.name==t));if(!o)return;let n=$(this.outerHTML);if(n.removeAttr("info").removeAttr("key"),o.amount){if(stash=n,"contextmenu"==e.type&&o.default)return o.twoValues?addAdvancedAction(t,o.default):addAction(t,o.default);{shiftHeld&&stash.attr("addToStart",!0);let e=$(`#action_${t}`);return e.css("display","flex"),void(replaceAction&&replaceAction.attr("action")==t&&(o.twoValues?($(e.find("input").first().val(replaceAction.attr("val1"))).trigger("input"),$(e.find("input").last().val(replaceAction.attr("val2"))).trigger("input")):$(e.find("input").first().val(replaceAction.attr("amount"))).trigger("input")))}}if(o.isTarget){let e=1;for(;$(`.action[action=jump][amount=${e}]`).length&&$(`.action[action=target][amount=${e}]`).length;)e++;n.attr("amount",e).append(`<p>${e}</p>`)}else o.set&&(o.showPlus&&n.attr("num","plus"),n.attr("amount",o.default).append(`<p>${getPrefix(n.attr("num"),o.default)}${o.default}</p>`));o.stopSounds&&stopSounds(),settings.noAnimations||n.addClass("placed"),"divider"==o.name&&!shiftHeld&&selectedDivider>=0&&selectedDivider++,updateRecent("."+t),addToSequence(n)})),$(document).on("click contextmenu","#sequence section",(function(e){if(!ctrlHeld)return;if(e.stopPropagation(),!hasDividers())return;let t=parseInt($(this).attr("group"));return isNaN(t)?void 0:"contextmenu"==e.type?(toggleSectionVisibility(t),!1):$(this).hasClass("selectedDivider")?deselectSection():(selectedDivider=t,isNaN(selectedDivider)?selectedDivider=-1:void displaySection())})),$(document).on("click","#sequence div",(function(){if(!ctrlHeld){if(cancel(),shiftHeld||altHeld){let e=$(this).clone();settings.noAnimations||e.addClass("placed"),e.insertAfter($(this)),playSound($(this).attr("sound"),{pitch:getPitch($(this)),volume:getVolume($(this)),stopPrevious:!0})}else $(this).remove();"divider"==$(this).attr("action")&&(deselectSection(),syncSections())}})),$(document).on("contextmenu","#sequence div",(function(){if(ctrlHeld||active)return!1;let e=$(this).attr("sound"),t=$(this).attr("action");if(shiftHeld||altHeld){let t=$(this).clone();return settings.noAnimations||t.addClass("placed"),addToSequence(t,!0,Number($(this).parent().attr("group"))),playSound(e,{pitch:getPitch($(this)),volume:getVolume($(this)),stopPrevious:!0}),!1}if($(this).hasClass("action")&&t){let e=actions.find((e=>e.name==t));if(!e||!e.amount)return!1;replaceAction=$(this);let o=$(`#actions div[action="${t}"]`);if(!o.length)return;return o.trigger("click"),!1}return!active&&e?(settings.noAnimations||$(this).runAnimation("placed"),playSound(e,{pitch:getPitch($(this)),volume:getVolume($(this)),stopPrevious:!0}),!1):void 0})),$(document).on("click",".hotbarTab:not(.selectedTab)",(function(){$(".selectedTab").removeClass("selectedTab"),$(this).addClass("selectedTab"),buildHotbar($(this).attr("tab"))})),$("#everything").scroll((function(){if(settings.dontFadeProBar||mobile)return;let e=200/1.5,t=Math.min(30,($(this).scrollTop()-200)/1.5),o=Math.max(0,(t+e)/(30+e)*100);$("#proHotbar").css("bottom",t+"px").css("opacity",o+"%").css("visibility",o<2?"hidden":"visible")}));let lastY=null,mobileCooldown=!1;$(document).on("wheel touchmove","#sequence div",(function(e){let t=$(this);if("touchmove"==e.type){if(mobileCooldown||$(".ui-sortable-helper").length)return;let t=e.originalEvent.touches[0].clientY,o=50;if(t>lastY+o)e.arrowDelta=21;else{if(!(t<lastY-o))return;e.arrowDelta=-21}lastY=t,mobileCooldown=!0,setTimeout((()=>{mobileCooldown=!1,$("#sequence div").scrollTop(200)}),25),$("#sequence div").scrollTop(200)}if(active||$(this).hasClass("ui-sortable-helper"))return;let o=ctrlHeld&&t.attr("sound"),n=(e.arrowDelta||e.originalEvent.deltaY)>0,i=actions.find((e=>e.name==t.attr("action"))),s=t.attr("amount")||t.attr("pitch")||t.find("p").text(),a=Number(s)||0;if(o&&(a=Number(t.attr("vol")),(isNaN(a)||a<0)&&(a=100)),t.attr("sound")&&!t.attr("str").startsWith("_")){let e=(n?-1:1)*(shiftHeld?o?10:6:altHeld?.2:1);if(o)1!=e&&-1!=e||(e*=2),a+=e,a=Number(clamp(a,0,400).toFixed(2)),100==a?t.find("vol").remove():t.find("vol").length?t.find("vol").text(a+"%"):t.append(`<vol>${a}%</vol>`),t.attr("vol",a),playSound(t.attr("sound"),{pitch:getPitch(t),volume:a/100/2,stopPrevious:!0});else{a+=e,a=Number(clamp(a,-60,60).toFixed(2));let o=a>0?"+":"";s&&0==a?t.find("p").remove():t.find("p").length?t.find("p").text(o+a):t.append(`<p>${o+a}</p>`),t.attr("pitch",a),playSound(t.attr("sound"),{pitch:semitonesToPercent(a),volume:getVolume(t),stopPrevious:!0})}}else if(t.attr("action")&&t.attr("amount")){let e=i[t.attr("num")||"set"],o=e[2]||1;shiftHeld?o*=10:altHeld&&(o/=10),a+=n?-1*o:o,a=Number(a.toFixed(4)),a=clamp(a,e[0],e[1]||999),t.attr("amount",a),t.find("p").text(getPrefix(t.attr("num"),a)+a+(e[3]||""))}else if(i&&t.attr("advanced")){let e=i.scroll,o=0==e[0]?"val1":"val2",s=+t.attr(o),a=i.twoValues[e[0]],c=+e[1]||1;shiftHeld?c*=10:altHeld&&(c/=10),s+=n?-1*c:c,s=clamp(s.toFixed(4),a[0],a[1]),t.attr(o,s),i.colorMode?t.find("p").children().last().text(t.attr("val2")):t.find("p").text(`${t.attr("val1")}, ${t.attr("val2")}`)}})),$(".iconbox, #proHotbar").bind("mousewheel DOMMouseScroll",(function(e){e.ctrlKey&&e.preventDefault()}));let intro=0,lecture=null,cachedIntros=[],mainNode=new GainNode(soundcloud);function loadIntro(){let e=intros[intro].path;cachedIntros[e]?lecture=cachedIntros[e]:fetch(e).then((e=>e.arrayBuffer())).then((e=>soundcloud.decodeAudioData(e))).then((t=>{cachedIntros[e]=t,lecture=t}))}$("#caption").click((function(){intro++,intro>=intros.length&&(intro=0),$("#caption").text(intros[intro].name).runAnimation("placed"),stopIntro(),loadIntro(),cancel()})),loadIntro();let activeIntro=null;function playIntro(){stopIntro();let e=new AudioBufferSourceNode(soundcloud,{buffer:lecture});mainNode.connect(soundcloud.destination),e.connect(mainNode),e.start(),activeIntro=e,e.addEventListener("ended",(()=>{e.dead||(beginSequence(),stopIntro())}))}function stopIntro(){activeIntro&&(activeIntro.dead=!0,activeIntro.disconnect(),activeIntro=null)}document.addEventListener("scroll",(function(e){$(e.target).is("#sequence div")&&$(e.target).scrollTop(200)}),!0),$("#sequence").on("DOMSubtreeModified",(function(e){$("#sequence div").scrollTop(200)})),$.fn.runAnimation=function(e){if(settings.noAnimations)return;let t=$(this)[0];t.style.animation="none",t.offsetHeight,t.style.animation=null,$(this).addClass(e)};let stash=null,replaceAction=null,defaultTempo=300,defaultVolume=100,preloaded=null,active=!1,scrubbing=!1,ctrlHeld=!1,shiftHeld=!1,altHeld=!1,onCooldown=!1,selectedDivider=-1,volume=0;function clamp(e,t,o){return Math.min(Math.max(e,t),o)}function percentToSemitones(e){return 12*Math.log(e,2)}function semitonesToPercent(e){return Math.pow(2,Number(e)/12)}function getPitch(e){return semitonesToPercent(e.find("p").text()||"0")}function getVolume(e){return Number(e.find("vol").text().slice(0,-1)||100)/200}function cancel(e={}){(!e.keepAnimations&&active||e.stopSounds)&&stopSounds(),active=!1,preloaded=null,updateTempo(defaultTempo),setVolume(100),e.keepAnimations||($(".bounce").removeClass("bounce"),$(".pulse").removeClass("pulse")),$(".playInfo").show(),$(".stopInfo").hide(),$(".pinnedHidden").removeClass("pinnedHidden"),$("#proHotbar").removeClass("playing"),$(".triggered").removeClass("triggered"),$("#sequence p[triggeredCountdown]").each((function(){resetAmount($(this))})),$("html").removeAttr("style"),stopIntro()}function resetAmount(e){let t=e.parent();e.text(getPrefix(t.attr("num"),+t.attr("amount"))+t.attr("amount")+(t.attr("suffix")||"")),e.removeAttr("triggeredcountdown")}function startSequence(e=!1){onCooldown||active||$("#sequence div").length<1||(onCooldown=!0,setTimeout((()=>{onCooldown=!1}),250),stopSounds(),cancel(),active=!0,$("#sectionSettings.pinnedSettings").addClass("pinnedHidden"),$("#proHotbar").addClass("playing"),$(".playInfo").hide(),$(".stopInfo").show(),preloaded=preloadSequence(),!e&&selectedDivider<0?playIntro():beginSequence())}function beginSequence(){preloaded&&($(".placed").removeClass("placed"),playSequence(preloaded))}function updateTempo(e){$("#BPM").text(+e.toFixed(4))}function setVolume(e){volume=Number(clamp(e/200,0,3).toFixed(4)),$("#volume").text(+(200*volume).toFixed(4))}updateTempo(defaultTempo),setVolume(defaultVolume);let activeSounds=[];function clearPlayedSounds(){activeSounds=activeSounds.filter((e=>!e.sound.finished))}function killSound(e,t,o=!0){e.finished=!0,e.disconnect(),t.disconnect(),o&&clearPlayedSounds()}function stopSounds(){activeSounds.forEach((e=>killSound(e.sound,e.gainNode,!1))),nextSoundToQueue=playingSequence.length,clearPlayedSounds()}let currentlyFetching={};async function fetchSound(e){if(!sounds[e]&&"sounds/pause.wav"!=e){currentlyFetching[e]=!0;let t=await fetch(e).then((e=>e.arrayBuffer())).then((e=>soundcloud.decodeAudioData(e)));sounds[e]=t,delete currentlyFetching[e]}}async function playSound(e,t={}){if(!e||"sounds/_pause.wav"==e)return;if(currentlyFetching[e]&&!t.playAt)return;sounds[e]||await fetchSound(e);let o=new AudioBufferSourceNode(soundcloud,{buffer:sounds[e],playbackRate:t.pitch||1}),n=new GainNode(soundcloud,{gain:isNaN(t.volume)?.5:t.volume});if(n.connect(soundcloud.destination),o.connect(n),t.stopPrevious){activeSounds.filter((t=>t.name==e)).forEach((e=>killSound(e.sound,e.gainNode,!1))),clearPlayedSounds()}let i=t.playAt||0;activeSounds.push({sound:o,gainNode:n,index:t.index||0,name:e,pitch:t.pitch||1,volume:volume,cut:!1,start:i}),o.start(i),o.addEventListener("ended",(()=>{killSound(o,n,!active)}))}function cutSounds(e){activeSounds.forEach((t=>{!t.cut&&t.start<=e&&(t.cut=!0,t.sound.stop(e))}))}function updateKeys(e){e.repeat||void 0===e.ctrlKey||("Alt"===e.key&&e.preventDefault(),shiftHeld=e.shiftKey,altHeld=e.altKey,ctrlHeld=e.ctrlKey,$("#sequence div:hover").trigger(shiftHeld||altHeld?"mouseover":"mouseleave"),$("#sequence section:not(.ctrlHeld):hover").trigger(ctrlHeld?"mouseover":"mouseleave"))}$(".skippableAction").each((function(){$(this).html("(right click to skip this popup)"),$(this).attr("mobile","(hold to skip this popup)")})),$("#clearsounds").click((function(){cancel({stopSounds:!0}),$("#sequence").html(""),$("#saveName").val(""),$("#sectionSettings").hide(),$(".popup").hide(),filename="sequence",saveLocation=null})),$(document).on("keydown",(function(e){if(e.originalEvent.repeat||"INPUT"==e.target.nodeName||mobile)return;let t=$(".popup").is(":visible");if(191==e.which)shiftHeld&&!$("#shortcutMenu").is(":visible")?$("#settingsMenu").toggle():ctrlHeld&&!$("#settingsMenu").is(":visible")&&$("#shortcutMenu").toggle();else if(t)27==e.which?$(".popup:not(.importantPopup)").hide():13==e.which&&$("button[actionConfirm=true]:visible").first().click();else if([13,32].includes(e.which))active?$("#stopBtn").click():$("#playBtn").triggerHandler("contextmenu"),e.preventDefault();else if([38,40].includes(e.which))if(ctrlHeld){changeSection(40==e.which?1:-1,!0)}else $("#sequence div:hover").first().trigger({type:"wheel",arrowDelta:40==e.which?69:-69}),e.preventDefault();else if(settings.proMode&&e.which>=48&&e.which<=57){let t=e.which-48;if(t<=0)return;$(".hotbarTab").eq(t-1).trigger("click")}else if(83==e.which&&e.ctrlKey)$(sexySaving&&!e.shiftKey?"#saveBtn":"#downloadBtn").trigger("click"),e.preventDefault();else if(79==e.which&&e.ctrlKey)$("#loadBtn").trigger("click"),e.preventDefault();else if(68==e.which&&e.ctrlKey)deselectSection(),e.preventDefault();else if(80==e.which&&e.ctrlKey)$("#toggleProMode").trigger("click"),e.preventDefault();else if(!ctrlHeld&&!altHeld&&!settings.noActionShortcuts){let t=actions.find((t=>t.shortcut==e.key.toLowerCase()));t&&$(`#actions .action[action="${t.name}"]`).trigger("click")}})),$(document).on("keyup keydown click wheel touchmove",updateKeys),$(window).on("blur focus",updateKeys),$(document).on("click",".popup:not(.importantPopup)",(function(e){$(e.target).is(".popup")&&($(".popup").hide(),stash=null,replaceAction=null)})),$(".colorPreview").click((function(){$(`.colorSelector[colorgroup=${$(this).attr("colorgroup")}`).trigger("click")})),$(".colorSelector").on("input",(function(){$(`.colorPreview[colorgroup=${$(this).attr("colorgroup")}`).css("background-color",$(this).val()),$(`.colorTextbox[colorgroup=${$(this).attr("colorgroup")}`).val($(this).val().slice(1))})),$(".colorTextbox").on("input",(function(){let e=$(this).val().toLowerCase().replace(/[^a-f0-9]/g,"").slice(0,6);$(this).val(e);let t="#"+e;t.match(colorRegex)&&$(".colorSelector").val(t).trigger("input")}));let settings={};try{settings=localStorage["🗿"]?JSON.parse(localStorage["🗿"]):{},$(".settingBox[setting]").each((function(){let e=$(this).attr("setting"),t=settings[e];$(this).attr("inverted")&&(t=!t),t&&$(this).prop("checked",t)}))}catch(e){console.error(e)}settings.pinSectionButtons&&$("#sectionSettings").addClass("pinnedSettings"),!settings.dontFadeProBar&&settings.proMode&&$("#everything").trigger("scroll"),$(document).on("change click",".settingBox",(function(){let e=$(this).attr("setting"),t=$(this).prop("checked");if($(this).attr("inverted")&&(t=!t),t?settings[e]=t:delete settings[e],localStorage["🗿"]=JSON.stringify(settings),"oldSaving"==e)t?disableNewSaving():enableNewSaving();else if("pinSectionButtons"==e)settings.pinSectionButtons?(active&&$("#sectionSettings").addClass("pinnedHidden"),$("#sectionSettings").addClass("pinnedSettings")):$("#sectionSettings").removeClass("pinnedSettings");else if("proMode"==e)if(settings.proMode){$(".hotbarTab").first().trigger("click"),$("#proHotbar").show(),$("#extraPadding").show();let e=$("#everything").prop("scrollHeight");ctrlHeld||$("#everything").animate({scrollTop:e+1e3})}else $("#proHotbar").hide(),$("#extraPadding").hide()})),$(".extraSetting").hover((function(){$("#settingInfo").text($(this).attr("title")),$("#settingInfo").show(),$("#settingHelp").hide()}),(function(){$("#settingInfo").hide(),$("#settingHelp").show()})),$(".extraSetting").click((function(e){mobile||e.isTrigger||"INPUT"==e.target.nodeName||$(this).find("input").trigger("click")}));